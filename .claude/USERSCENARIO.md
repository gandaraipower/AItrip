# 👤 사용자 시나리오 & User Journey (최종)

## 🎯 핵심 개념

**둘 다 루트를 먼저 보고 거기서 수정/삭제하면 루트 재생성!**

```
Mode A:
AI 추천 → [지도 + 시간표] → 수정/삭제 → 루트 재생성 → 확정

Mode B:
지도 선택 → [지도 + 시간표] → 수정/삭제 → 루트 재생성 → 확정

```

---

## 📱 Phase 1: 로그인

```
┌─────────────────┐
│  앱 실행 & 로그인 │
└────────┬────────┘
         │
    ✅ User 저장
         │
         ▼
    ┌─────────────────┐
    │  메인 화면      │
    └─────────────────┘

```

---

## 📝 Phase 2: 여행 기본 정보 입력

```
┌──────────────────────────────┐
│  "새 여행 계획" 버튼 클릭    │
└────────────┬─────────────────┘
             │
    여행 기본 정보 입력:
    ├─ 여행 제목: "봄 여행"
    ├─ 출발일: 2025-03-10
    ├─ 귀가일: 2025-03-13
    ├─ 지역: 서울
    ├─ 여행 스타일: "감성적인 카페와 소품샵 위주"
    └─ 페이스: "보통"
             │
    "다음" 버튼 클릭
             │
             ▼
    💾 Trip 생성 (status='draft')
    INSERT INTO trip (user_id, title, region, style, ...)
    → trip_id = 1

```

---

## 🔀 Phase 2-1: 일정 생성 방식 선택

```
┌─────────────────────────────────────┐
│  "여행 일정을 어떻게 만들까요?"    │
├─────────────────────────────────────┤
│                                     │
│  [🤖 AI 추천받기]                  │
│  [🗺️ 지도에서 직접]                │
│                                     │
└─────────────────────────────────────┘
        ↙           ↘
    Mode A          Mode B

```

---

# 🤖 Mode A: AI 추천 후 수정

## Phase 3A: AI가 추천 장소 + 최적 루트 자동 생성

```
┌──────────────────────────────┐
│  "스타일에 맞는 일정을        │
│   자동으로 만들어줄게!"      │
└────────────┬─────────────────┘
             │
    💾 TripPlace 자동 생성 (약 15~20개)
    INSERT INTO trip_place (...)

    💾 FastAPI: 최적 루트 계산
    ├─ PlaceMovingTime으로 이동시간
    ├─ PlaceCrowdData로 웨이팅
    ├─ TSP로 최적 순서 정렬
    └─ 시간 배치

    💾 Schedule 생성 (N개 - 선택한 장소 개수만큼)
    INSERT INTO schedule (...)
             │
             ▼
    [AI 추천 완료! 확인해보세요]

```

## Phase 4A: 지도 + 시간표 보기 & 수정

```
┌──────────────────────────────┐
│  "AI가 추천한 최적 루트"     │
│  (지도 + 시간표)            │
└────────────┬─────────────────┘
             │
    🗺️ 왼쪽: 지도 (루트 시각화)

    도착지 → ① → ② → ③ → ④ → 숙소

    📋 오른쪽: 시간표 + 정보

    📅 Day 1 (3월 10일)

    ├─ 10:00 블루보틀 ☕
    │         📍 강남구 압구정로 27
    │         ⏱️ 대기: 30분
    │         ⏱️ 체류: 45분
    │         이동: 15분
    │         [❌ 제거] [🔄 바꾸기]
    │
    ├─ 12:00 런던베이글 🥖
    │         📍 종로구 인사동길 35
    │         ⏱️ 대기: 40분
    │         ⏱️ 체류: 60분
    │         이동: 20분
    │         [❌ 제거] [🔄 바꾸기]
    │
    └─ 13:30 남산타워 🗼
             📍 용산구 남산공원길 105
             ⏱️ 대기: 40분
             ⏱️ 체류: 90분
             [❌ 제거] [🔄 바꾸기]

    [+ 더 추가] [🤖 AI 재제안]

```

## Phase 5A: 사용자가 수정/삭제 → 루트 자동 재생성

```
┌────────────────────────────────┐
│  사용자가 루트 조정            │
│  (제거/바꾸기/추가)           │
└────────────┬───────────────────┘
             │
    사용자 액션:

    ❌ "블루보틀 빼고 싶어" → 제거 클릭
       ↓
       DELETE FROM trip_place WHERE trip_id=1 AND place_id=102

       ↓ FastAPI: 즉시 루트 재생성!
       DELETE FROM schedule WHERE trip_id=1
       [새로운 장소들로 TSP 계산]
       INSERT INTO schedule (...) ×(N-1)개

       ↓
       🗺️ 지도 + 시간표 자동 갱신!

    🔄 "블루보틀 대신 다른 카페" → 바꾸기
       ↓
       DELETE FROM trip_place WHERE trip_id=1 AND place_id=102
       INSERT INTO trip_place VALUES (1, 106)

       ↓ FastAPI: 즉시 루트 재생성!

       ↓
       🗺️ 지도 + 시간표 자동 갱신!

    ✅ "[+] 다른 맛집 추가" → 추가
       ↓
       INSERT INTO trip_place VALUES (1, 107)

       ↓ FastAPI: 즉시 루트 재생성!
       DELETE FROM schedule WHERE trip_id=1
       [새로운 장소들로 TSP 계산]
       INSERT INTO schedule (...) ×(N+1)개

       ↓
       🗺️ 지도 + 시간표 자동 갱신!
             │
    수정 완료 후 "저장" 클릭
             │
             ▼
    💾 Trip 업데이트
    UPDATE trip SET status = 'scheduled'
             │
             ▼
    "여행 준비 완료! 🎉"

```

---

# 🗺️ Mode B: 지도에서 선택 후 수정

## Phase 3B: 지도에서 장소 선택

```
┌────────────────────────────────┐
│  "지도에서 장소를 추가해주세요"│
│  (감성순 필터링된 마커)        │
└────────────┬───────────────────┘
             │
    🗺️ 지도:
    [감성순 필터링된 마커들]

    마커 클릭 시 팝업:
    ┌────────────────────┐
    │  블루보틀          │
    │  📍 강남구 압구정  │
    │  ⭐ 감성: 0.92    │
    │  [가고싶어요!]     │
    └────────────────────┘

    ... (계속 선택)

    최종: 15개 선택 (메모리)
             │
    [완료] 버튼 클릭
             │
             ▼
    💾 TripPlace 생성 (×15개)
    INSERT INTO trip_place (...)

```

## Phase 4B: AI가 최적 루트 자동 생성 후 표시

```
┌──────────────────────────────┐
│  "최적의 루트를 계산 중..."  │
└────────────┬─────────────────┘
             │
    FastAPI: 최적 루트 계산
    ├─ PlaceMovingTime으로 이동시간
    ├─ PlaceCrowdData로 웨이팅
    ├─ TSP로 최적 순서 정렬
    │  (사용자 추가 순서 무시!)
    └─ 시간 배치
             │
    💾 Schedule 생성 (N개 - 선택한 장소 개수)
    INSERT INTO schedule (...)
             │
             ▼
    🗺️ 지도 + 시간표 자동 표시!

```

## Phase 5B: 사용자가 수정/삭제 → 루트 자동 재생성 (Mode A와 동일)

```
┌────────────────────────────────┐
│  "AI가 제안한 최적 루트"       │
│  (지도 + 시간표)              │
└────────────┬───────────────────┘
             │
    🗺️ 왼쪽: 지도 (루트 시각화)

    사용자가 추가한 순서: ① → ② → ③
    AI 최적 루트: ② → ① → ③

    📋 오른쪽: 시간표 + 정보

    📅 Day 1 (3월 10일)

    ├─ 10:00 런던베이글 🥖
    │         📍 종로구 인사동길 35
    │         ⏱️ 대기: 40분
    │         ⏱️ 체류: 60분
    │         이동: 20분
    │         [❌ 제거] [🔄 바꾸기]
    │
    ├─ 12:00 블루보틀 ☕
    │         📍 강남구 압구정로 27
    │         ⏱️ 대기: 30분
    │         ⏱️ 체류: 45분
    │         이동: 15분
    │         [❌ 제거] [🔄 바꾸기]
    │
    └─ 13:30 남산타워 🗼
             [❌ 제거] [🔄 바꾸기]

    [+ 더 추가]
             │
    사용자 수정 시:

    ❌ 제거 → FastAPI 즉시 루트 재생성
    🔄 바꾸기 → FastAPI 즉시 루트 재생성
    ✅ 추가 → FastAPI 즉시 루트 재생성
             │
    "저장" 클릭
             │
             ▼
    💾 Trip.status = 'scheduled'
             │
             ▼
    "여행 준비 완료! 🎉"

```

---

## 💾 DB 저장 시점 정리

| Phase | Mode A | Mode B | SQL |
| --- | --- | --- | --- |
| **2** | ✅ | ✅ | INSERT INTO trip |
| **3A** | ✅ Auto | - | INSERT INTO trip_place (자동) |
| **3B** | - | ❌ 메모리 | - |
| **4B** | - | ✅ Manual | INSERT INTO trip_place (수동) |
| **4A/4B** | ✅ Auto | ✅ Auto | INSERT INTO schedule (TSP) |
| **5A/5B** | ✅ Manual | ✅ Manual | UPDATE trip_place (제거/추가) |
| **5A/5B (재생성)** | ✅ Auto | ✅ Auto | DELETE/INSERT schedule (새로운 TSP) |
| **6A/6B** | ✅ | ✅ | UPDATE trip SET status='scheduled' |

---

## 🎯 핵심 포인트

**Mode A & B 공통:**

```
루트 생성 후:

[지도 + 시간표] 표시
         ↓
    사용자 수정 (제거/바꾸기/추가)
         ↓
    FastAPI: 즉시 루트 재생성
         ↓
    [지도 + 시간표] 자동 갱신
         ↓
    반복 가능 (원하는 만큼!)
         ↓
    "저장" → 최종 확정

```

**즉시 피드백:**

- 제거하면 바로 새로운 루트 시각화
- 추가하면 바로 새로운 루트 시각화
- 바꾸면 바로 새로운 루트 시각화

**완성! 이제 정말 사용자 친화적인 UX!** ✅